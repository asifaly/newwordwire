"use strict";angular.module("wwnewApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).constant("FIREBASE_URI","https://wordwire.firebaseio.com/").run(["$templateCache","$http","$rootScope","$location",function(a,b,c,d){c.$on("$routeChangeError",function(a,b,c,e){"AUTH_REQUIRED"===e&&d.path("/login")})}]).config(["$routeProvider",function(a){a.when("/game",{templateUrl:"views/game.html",controller:"WordCtrl",resolve:{currentAuth:["Auth",function(a){return a.$requireAuth()}]}}).when("/login",{templateUrl:"views/login.html",controller:"WordCtrl",resolve:{currentAuth:["Auth",function(a){return a.$waitForAuth()}]}}).when("/players",{templateUrl:"views/players.html",controller:"WordCtrl",resolve:{currentAuth:["Auth",function(a){return a.$requireAuth()}]}}).when("/words",{templateUrl:"views/words.html",controller:"WordCtrl",resolve:{currentAuth:["Auth",function(a){return a.$requireAuth()}]}}).when("/main",{templateUrl:"views/main.html",controller:"WordCtrl"}).otherwise({redirectTo:"/main"})}]),angular.module("wwnewApp").controller("WordCtrl",["$scope","$firebase","FIREBASE_URI","$timeout","$window","$filter","Auth","UserService","WordsService","$location",function(a,b,c,d,e,f,g,h,i,j){a.stats={},a.stats.pattern=new RegExp,a.newword={name:"",score:""},a.user={displayName:"",uid:"",avatar:""},a.isActive=function(a){return a===j.path()};var k=new Firebase(c+"stats/");a.authObj=g,a.logout=function(){a.authObj.$unauth(),Firebase.goOffline(),a.user={displayName:"",uid:""},j.path("/login")},a.login=function(b){Firebase.goOnline(),a.authObj.$authWithOAuthPopup(b).then(function(a){j.path("/game"),h.addUser(a).then(function(){console.info("New User Added")}).catch(function(a){console.error("Authentication failed:",a)})})},a.authObj.$onAuth(function(b){b?h.presence(b).then(function(b){a.user=b}):console.log("Logged out")}),k.on("value",function(b){d(function(){a.stats=b.val(),a.stats.pattern=f("strtoregex")(b.val().pattern)})}),a.words=i.getWords(),a.onlineusers=h.getOnline(),a.addWord=function(){a.isReadOnly=!0;var b=f("lowercase")(a.newword.name),c=f("firstlet")(b),d=f("regtostr")(a.stats.pattern,c);i.checkWord(b).then(function(){i.dictCheck(b).then(function(e){for(var f in e)a.newword[f]=e[f];i.addWord(angular.copy(a.newword)).then(function(b){console.info("New Word added at "+b),a.isReadOnly=!1,a.theForm.$setPristine(),a.newword={name:"",score:""}}),i.setStats(b,d,c).then(function(a){console.info("stats added at "+a)})}).catch(function(b){e.alert(b),a.isReadOnly=!1})}).catch(function(b){e.alert(b),a.isReadOnly=!1})},a.$watch("newword.name",function(b){a.newword.score=f("score")(b)})}]),angular.module("wwnewApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("wwnewApp").filter("firstlet",function(){return function(a){return void 0!==a?a=a.charAt(a.length-1):a}}),angular.module("wwnewApp").filter("strtoregex",function(){return function(a){return void 0!==a?(a=a.split("/"),a=new RegExp(a[1],a[2])):a}}),angular.module("wwnewApp").filter("regtostr",function(){return function(a,b){return void 0!==a?(a=a.toString().split(""),a[4]=b,a=a.join("")):a}}),angular.module("wwnewApp").filter("score",function(){return function(a){var b,c={A:1,B:3,C:3,D:2,E:1,F:4,G:2,H:4,I:1,J:8,K:5,L:1,M:3,N:1,O:1,P:3,Q:10,R:1,S:1,T:1,U:1,V:4,W:4,X:8,Y:4,Z:10},d=0;if(void 0!==a){for(a=a.toUpperCase(),b=0;b<a.length;b+=1)d+=c[a.charAt(b)]||0;return d}return d=0}}),angular.module("wwnewApp").service("UserService",["$log","$q","FIREBASE_URI","$firebase",function(a,b,c,d){var e=new Firebase(c),f=new Firebase(c+"users/"),g=new Firebase(c+".info/connected"),h=new Firebase(c+"presence/"),i=d(h).$asArray();return{presence:function(a){var e=b.defer();return g.on("value",function(b){var f=new Firebase(c+"presence/"+a.uid),g={},h=d(f);b.val()&&(f.onDisconnect().remove(),"google"===a.provider?(g.displayName=a.google.displayName,g.avatar=a.google.cachedUserProfile.picture):"facebook"===a.provider?(g.displayName=a.facebook.displayName,g.avatar=a.facebook.cachedUserProfile.picture.data.url):"twitter"===a.provider&&(g.displayName=a.twitter.displayName,g.avatar=a.twitter.cachedUserProfile.profile_image_url_https),g.uid=a.uid,g.online=!0,e.resolve(g),h.$set(g))}),e.promise},addUser:function(c){var d=b.defer();return f.child(c.uid).once("value",function(b){null!==b.val()?a.info("User Already Exists"):(e.child("users").child(c.uid).set(c),a.info("New UserUser ID: "+c.uid+" created"))}),a.info("Authentication Successful"),d.promise},getOnline:function(){return i}}}]),angular.module("wwnewApp").service("WordsService",["$http","$log","$q","$window","FIREBASE_URI","$firebase","$filter",function(a,b,c,d,e,f){var g=new Firebase(e+"words/"),h=f(g).$asArray(),i=new Firebase(e+"stats/"),j=f(i);return{dictCheck:function(d){var e=c.defer(),f="https://api.wordnik.com/v4/word.json/"+d+"/definitions?limit=1&includeRelated=false&sourceDictionaries=webster%2Cwordnet&useCanonical=false&includeTags=false&api_key=9a67169ed9a424f1400000112af04acdc9cf96bea0fe263ed";return a.get(f).success(function(a){a.length>0?e.resolve({name:a[0].word,definition:a[0].text,pos:a[0].partOfSpeech,attr:a[0].attributionText,source:a[0].sourceDictionary}):e.reject(new Error("Word Not Found in Dictionary"))}).error(function(a,c){e.reject(a),b.error(a,c)}),e.promise},getWords:function(){return h},addWord:function(a){var d=c.defer();return h.$add(a).then(function(a){b.info(a.key()),d.resolve(a.key())}),d.promise},checkWord:function(a){var b=c.defer();return g.orderByChild("name").equalTo(a).once("value",function(a){null!==a.val()?b.reject(new Error("Word already exists chose another")):b.resolve()}),b.promise},setStats:function(a,b,d){var e=c.defer();return j.$set({firstletter:d,lastword:a,pattern:b}).then(function(a){e.resolve(a.key())}).catch(function(){e.reject(new Error("Stats Could not be updated"))}),e.promise}}}]),angular.module("wwnewApp").service("Auth",["$firebaseAuth","FIREBASE_URI",function(a,b){var c=new Firebase(b);return a(c)}]);